<!DOCTYPE html>
<html>
<head>
  <title>Customers</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <!-- Root-level view => include from 'partials/...' -->
  <%- include('/partials/_navbar') %>

  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="mb-0">Customers</h1>
    </div>

    <% if (typeof errors !== 'undefined' && errors && errors.length) { %>
      <div class="alert alert-danger"><%= errors.join('<br>') %></div>
    <% } %>
    <% if (typeof messages !== 'undefined' && messages && messages.length) { %>
      <div class="alert alert-success"><%= messages.join('<br>') %></div>
    <% } %>

    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead>
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>First</th>
            <th>Last</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Role</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% (users || []).forEach(u => { %>
            <tr>
              <td><%= u.customer_id %></td>
              <td><%= u.username %></td>
              <td><%= u.first_name || '' %></td>
              <td><%= u.last_name || '' %></td>
              <td><%= u.email %></td>
              <td><%= u.phone_number || '-' %></td>
              <td>
                <span class="badge <%= u.role === 'admin' ? 'bg-primary' : 'bg-secondary' %>">
                  <%= u.role %>
                </span>
              </td>
              <td class="text-end">
                <!-- Change role -->
                <form class="d-inline" method="POST" action="/customers/edit-role/<%= u.customer_id %>">
                  <select name="role" class="form-select form-select-sm d-inline-block w-auto me-2">
                    <option value="regular" <%= u.role==='regular'?'selected':'' %>>regular</option>
                    <option value="admin"   <%= u.role==='admin'  ?'selected':'' %>>admin</option>
                  </select>
                  <button class="btn btn-sm btn-outline-primary">Update</button>
                </form>

                <!-- Delete -->
                <form class="d-inline ms-2" method="POST" action="/customers/delete/<%= u.customer_id %>"
                      onsubmit="return confirm('Delete this customer? This cannot be undone.')">
                  <button class="btn btn-sm btn-outline-danger">Delete</button>
                </form>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
