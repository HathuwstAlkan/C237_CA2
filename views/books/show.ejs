<!DOCTYPE html>
<html>
<head>
  <title><%= book.title %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
</head>
<body>
    <%- include('../partials/navbar', { user: user, activePage: 'books' }) %>
<div class="container py-4">
  <a href="/books" class="btn btn-link mb-3">&larr; Back to Books</a>

  <div class="card mb-4">
    <div class="row g-0">
      <div class="col-md-4 p-3">
        <% if (book.image_url) { %>
          <img src="<%= book.image_url %>" class="img-fluid" alt="cover">
        <% } else { %>
          <div class="bg-light border d-flex align-items-center justify-content-center" style="height: 240px;">No Image</div>
        <% } %>
      </div>
      <div class="col-md-8">
        <div class="card-body">
          <h2 class="card-title"><%= book.title %></h2>
          <p class="mb-1"><strong>Author:</strong> <%= book.author || '-' %></p>
          <p class="mb-1"><strong>ISBN:</strong> <%= book.isbn || '-' %></p>
          <p class="mb-1"><strong>Genre:</strong> <%= book.genre || '-' %></p>
          <% if (publishers && publishers.length) { %>
            <li class="list-group-item">
              <strong>Publisher<%= publishers.length > 1 ? 's' : '' %>:</strong>
              <%= publishers.map(p => p.name).join(', ') %>
            </li>
          <% } %>

          <p class="mb-1"><strong>Published year:</strong> <%= book.published_year || '-' %></p>
          <p class="mb-3"><strong>Price:</strong> $<%= Number(book.price).toFixed(2) %></p>

          <p class="card-text"><%= book.description || 'No description.' %></p>

          <% if (user) { %>
            <form method="POST" action="/cart" class="d-inline">
              <input type="hidden" name="book_id" value="<%= book.book_id %>">
              <input type="hidden" name="quantity" value="1">
              <button class="btn btn-success">ðŸ›’ Add to Cart</button>
            </form>
          <% } else { %>
            <a href="/" class="btn btn-outline-primary">Log in to add to cart</a>
          <% } %>

          <% if (user && user.role === 'admin') { %>
            <a href="/books/<%= book.book_id %>/edit" class="btn btn-outline-secondary ms-2">Edit</a>
          <% } %>
        </div>
      </div>
    </div>
  </div>

  <!-- Related books -->
  <%- include('../partials/relatedBooks', { related }) %>
</div>
</body>
</html>
